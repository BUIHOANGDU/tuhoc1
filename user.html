<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trang c√° nh√¢n ng∆∞·ªùi d√πng</title>
    <!-- Favicon cho c√°c n·ªÅn t·∫£ng v√† k√≠ch th∆∞·ªõc kh√°c nhau -->
    <link
      rel="icon"
      type="image/png"
      href="https://cdn.glitch.global/ec94bd1d-e727-4713-b926-b78cb8642a89/favicon-32x32.png?v=1747654478479"
    />
    <link
      rel="shortcut icon"
      href="https://cdn.glitch.global/ec94bd1d-e727-4713-b926-b78cb8642a89/favicon-32x32.png?v=1747654478479"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="https://cdn.glitch.global/ec94bd1d-e727-4713-b926-b78cb8642a89/apple-touch-icon.png?v=1747654435265"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="128x128"
      href="https://cdn.glitch.global/ec94bd1d-e727-4713-b926-b78cb8642a89/favicon-128x128.png?v=1747654446725"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="64x64"
      href="https://cdn.glitch.global/ec94bd1d-e727-4713-b926-b78cb8642a89/favicon-64x64.png?v=1747654457793"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="48x48"
      href="https://cdn.glitch.global/ec94bd1d-e727-4713-b926-b78cb8642a89/favicon-48x48.png?v=1747654472675"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="https://cdn.glitch.global/ec94bd1d-e727-4713-b926-b78cb8642a89/favicon-32x32.png?v=1747654478479"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="https://cdn.glitch.global/ec94bd1d-e727-4713-b926-b78cb8642a89/favicon-16x16.png?v=1747654486534"
    />

    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f9f9f9;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }
      .profile-box {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
        text-align: center;
        width: 400px;
      }
      .profile-box img {
        width: 120px;
        height: 120px;
        object-fit: cover;
        border-radius: 50%;
        margin-bottom: 15px;
      }
      h2 {
        margin: 10px 0 5px;
        color: #ff3366;
      }
      p {
        margin: 5px 0;
        color: #555;
      }
      .btn-group {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
      }
      .btn-group button {
        flex: 1;
        margin: 0 5px;
        padding: 10px;
        background: #ff3366;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: 0.3s;
      }
      .btn-group button:hover {
        background: #ff4d6d;
      }
      .compatibility {
        margin-top: 20px;
        background: #fff0f5;
        padding: 15px;
        border-radius: 8px;
        font-size: 14px;
        color: #444;
        text-align: left;
      }
      .highlight {
        color: green;
        font-weight: bold;
      }
      .contrast {
        color: orange;
      }
    </style>
  </head>
  <body>
    <div class="profile-box" id="userProfile">
      <p>ƒêang t·∫£i th√¥ng tin...</p>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
      import {
        getAuth,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-auth.js";
      import {
        getFirestore,
        doc,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyAK7OVFlCVjkxuKkXuQ6ZEdMFM4x7ohTBU",
        authDomain: "henhovietnhat.firebaseapp.com",
        projectId: "henhovietnhat",
        storageBucket: "henhovietnhat.appspot.com",
        messagingSenderId: "934244268292",
        appId: "1:934244268292:web:d2f69f325473b3534ef851",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      const profileDiv = document.getElementById("userProfile");
      const userId = new URLSearchParams(window.location.search).get("id");

      const MBTI_REASON = {
        INFP_ENFJ:
          "INFP s·ªëng n·ªôi t√¢m, m∆° m·ªông. ENFJ nhi·ªát huy·∫øt, ƒë·ªãnh h∆∞·ªõng. H·ªç h·ªó tr·ª£ nhau trong c·∫£m x√∫c v√† h√†nh ƒë·ªông.",
        ENFJ_INFP:
          "ENFJ ch·ªß ƒë·ªông c·∫£m x√∫c, INFP th·∫•u hi·ªÉu nh·∫π nh√†ng. H·ªç chia s·∫ª l√Ω t∆∞·ªüng s·ªëng c√πng nhau.",
        INFJ_ENFP:
          "INFJ tr·∫ßm l·∫∑ng, s√¢u s·∫Øc. ENFP s√¥i n·ªïi, s√°ng t·∫°o. C·∫∑p ƒë√¥i gi√∫p nhau m·ªü r·ªông v√† hi·ªÉu ch√≠nh m√¨nh.",
        ENFP_INFJ:
          "ENFP l√†m INFJ vui v·∫ª, INFJ gi√∫p ENFP ƒë·ªãnh h∆∞·ªõng r√µ r√†ng h∆°n.",
        ISFP_ESFJ:
          "ISFP d·ªãu d√†ng, s·ªëng ngh·ªá sƒ©. ESFJ nƒÉng ƒë·ªông, chƒÉm s√≥c. H·ªç h√≤a h·ª£p trong ƒë·ªùi s·ªëng t√¨nh c·∫£m.",
        ESFJ_ISFP:
          "ESFJ ch·ªß ƒë·ªông v√† g·∫Øn k·∫øt. ISFP c·∫ßn kh√¥ng gian ri√™ng. H·ªç c√¢n b·∫±ng gi·ªØa chƒÉm s√≥c v√† t·ª± do.",
        INTJ_ENFP:
          "INTJ l√Ω tr√≠, t·∫ßm nh√¨n. ENFP gi√†u c·∫£m x√∫c. ENFP gi√∫p INTJ m·ªÅm m·∫°i, INTJ gi√∫p ENFP ƒë·ªãnh h∆∞·ªõng.",
        ENFP_INTJ:
          "ENFP l√†m INTJ c·∫£m nh·∫≠n cu·ªôc s·ªëng. INTJ gi√∫p ENFP ki√™n ƒë·ªãnh h∆°n.",
        ISTJ_ESFP:
          "ISTJ nghi√™m t√∫c, ESFP vui v·∫ª. H·ªç h·ªçc h·ªèi s·ª± ·ªïn ƒë·ªãnh v√† linh ho·∫°t t·ª´ nhau.",
        ESFP_ISTJ:
          "ESFP mang ni·ªÅm vui, ISTJ l√† ƒëi·ªÉm t·ª±a. H·ªç t·∫°o n√™n m·ªëi quan h·ªá v·ª´a vui v·∫ª v·ª´a v·ªØng ch·∫Øc.",
        INTP_ENTJ:
          "INTP s√°ng t·∫°o, ENTJ quy·∫øt ƒëo√°n. ENTJ gi√∫p INTP th·ª±c hi·ªán ho√° √Ω t∆∞·ªüng, INTP l√†m ENTJ suy ng·∫´m s√¢u h∆°n.",
        ENTJ_INTP:
          "ENTJ d·∫´n d·∫Øt, INTP linh ho·∫°t. H·ªç ph√°t tri·ªÉn qua t√¥n tr·ªçng tr√≠ tu·ªá nhau.",
        ISFJ_ENFP:
          "ISFJ chu ƒë√°o, ENFP ƒë·∫ßy nƒÉng l∆∞·ª£ng. H·ªç b·ªï sung s·ª± ·ªïn ƒë·ªãnh v√† h·ª©ng kh·ªüi cho nhau.",
        ENFP_ISFJ:
          "ENFP l√†m m·ªõi cu·ªôc s·ªëng ISFJ, ISFJ t·∫°o c·∫£m gi√°c an to√†n cho ENFP.",
        ISTP_ESTJ:
          "ISTP th·ª±c t·∫ø, ESTJ t·ªï ch·ª©c. ISTP gi√∫p ESTJ linh ho·∫°t, ESTJ ƒë·ªãnh h∆∞·ªõng cho ISTP.",
        ESTJ_ISTP:
          "ESTJ h√†nh ƒë·ªông, ISTP s√°ng t·∫°o. S·ª± kh√°c bi·ªát t·∫°o n√™n t√≠nh b·ªï sung tuy·ªát v·ªùi.",
      };

      function compare(val1, val2) {
        if (!val1 || !val2) return "(Thi·∫øu d·ªØ li·ªáu)";
        return val1 === val2
          ? `<span class="highlight">‚úÖ Tr√πng kh·ªõp</span>`
          : `<span class="contrast">üîÑ Kh√°c nhau</span>`;
      }

      onAuthStateChanged(auth, async (user) => {
        if (!user) return (window.location.href = "index.html");

        const userRef = doc(db, "users", userId);
        const quizRef = doc(db, "quizResults", userId);
        const myQuizRef = doc(db, "quizResults", user.uid);

        const [userSnap, quizSnap, myQuizSnap] = await Promise.all([
          getDoc(userRef),
          getDoc(quizRef),
          getDoc(myQuizRef),
        ]);

        if (!userSnap.exists())
          return (profileDiv.innerHTML = `<p>Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng n√†y.</p>`);

        const info = userSnap.data();
        const quiz = quizSnap.exists() ? quizSnap.data() : {};
        const myQuiz = myQuizSnap.exists() ? myQuizSnap.data() : null;

        const avatar = info.avatar || "https://via.placeholder.com/120";
        const gender = info.gender || "Ch∆∞a r√µ";
        const interests = info.interestedIn?.join(", ") || "Kh√¥ng r√µ";
        const joinDate = info.joinedAt
          ? new Date(info.joinedAt).toLocaleDateString("vi-VN")
          : "---";

        let explainBlock = "";
        if (myQuiz && myQuiz.mbti && quiz.mbti) {
          const key = `${myQuiz.mbti}_${quiz.mbti}`;
          const reason = MBTI_REASON[key];
          explainBlock += `<div class="compatibility"><strong>üíñ T∆∞∆°ng h·ª£p MBTI:</strong><br>${
            reason || "Kh√¥ng c√≥ l√Ω gi·∫£i chi ti·∫øt cho c·∫∑p n√†y."
          }</div>`;
        }

        if (myQuiz && quiz) {
          explainBlock += `<div class="compatibility">
            <strong>üîç So s√°nh gi·ªØa hai b·∫°n:</strong><br>
            üíò Love Style: ${compare(myQuiz.loveStyle, quiz.loveStyle)}<br>
            üè† Lifestyle: ${compare(myQuiz.lifestyle, quiz.lifestyle)}<br>
            üç± Gu m√†u & ·∫©m th·ª±c: ${compare(
              myQuiz.colorFoodStyle,
              quiz.colorFoodStyle
            )}
          </div>`;
        }

        profileDiv.innerHTML = `
          <img src="${avatar}" alt="Avatar" />
          <h2>${info.name}</h2>
          <p>Tu·ªïi: ${info.age}</p>
          <p>Gi·ªõi t√≠nh: ${gender}</p>
          <p>S·ªü th√≠ch: ${info.bio}</p>
          <p>Quan t√¢m ƒë·∫øn: ${interests}</p>
          <p>Tham gia t·ª´: ${joinDate}</p>
          <p><strong>MBTI:</strong> ${quiz.mbti || "(Ch∆∞a c√≥)"}</p>
          <p><strong>Love Style:</strong> ${quiz.loveStyle || "(Ch∆∞a c√≥)"}</p>
          <p><strong>Lifestyle:</strong> ${quiz.lifestyle || "(Ch∆∞a c√≥)"}</p>
          <p><strong>Color & Food Style:</strong> ${
            quiz.colorFoodStyle || "(Ch∆∞a c√≥)"
          }</p>
          ${explainBlock}
          <div class="btn-group">
            <button onclick="window.location.href='home.html'">‚¨Ö Trang ch·ªß</button>
            <button onclick="sendMessage()">G·ª≠i tin nh·∫Øn</button>
          </div>
        `;
      });

      window.sendMessage = () => {
        alert("Ch·ª©c nƒÉng g·ª≠i tin nh·∫Øn ch∆∞a ƒë∆∞·ª£c tri·ªÉn khai.");
      };
    </script>
  </body>
</html>
